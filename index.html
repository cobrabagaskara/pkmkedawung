<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥ PKM Kedawung - Script Installer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ PKM Kedawung</h1>
            <p class="subtitle">Sistem Distribusi Script Otomatis</p>
        </div>

        <div class="card">
            <div class="status-badge" id="statusBadge"></div>
            
            <div class="info-box">
                <strong>ğŸš€ Otomatisasi Pelayanan PKM</strong><br>
                Cukup install <em>satu kali</em>, semua fitur otomatis ter-update dari repository.
                <br><br>
                <strong>âœ¨ "Ubah sekali di GitHub, berlaku di semua komputer."</strong>
            </div>

            <div class="btn-group">
                <a
                    href="https://raw.githubusercontent.com/cobrabagaskara/pkmkedawung/main/loader.user.js"
                    class="btn btn-prod"
                    target="_blank"
                    rel="noopener"
                    onclick="trackInstall('production')"
                >
                    ğŸ¯ Install Versi PRODUKSI (Stabil)
                </a>

                <a
                    href="https://raw.githubusercontent.com/cobrabagaskara/pkmkedawung/dev/loader.user.js"
                    class="btn btn-dev"
                    target="_blank"
                    rel="noopener"
                    onclick="trackInstall('development')"
                >
                    ğŸ§ª Install Versi DEVELOPMENT (Fitur Terbaru)
                </a>
            </div>

            <div class="qr-section">
                <p class="qr-label">ğŸ“± Atau scan QR Code:</p>
                <img 
                    src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://cobrabagaskara.github.io/pkmkedawung/"
                    alt="QR Code Install PKM Script" 
                    class="qr-code"
                >
                <p class="qr-desc">Scan untuk buka halaman installer di HP</p>
            </div>

            <div class="manual-install">
                <h3>ğŸ“ Cara Install Manual:</h3>
                <ol>
                    <li>Buka Tampermonkey â†’ Create a new script</li>
                    <li>Copy seluruh kode dari <a href="loader.user.js" target="_blank">loader.user.js</a></li>
                    <li>Paste dan klik Save</li>
                </ol>
            </div>

            <div class="footer-note">
                <p>Setelah klik tombol di atas, browser akan membuka halaman instalasi Tampermonkey.<br>
                Klik <strong>"Install"</strong> â†’ selesai!</p>
                <p class="version">Version: <span id="version">Loading...</span> â€¢ Dibuat untuk Tim PKM Kedawung</p>
            </div>
        </div>
    </div>

    <script>
        // Cek apakah Tampermonkey terinstall
        function checkTampermonkey() {
            const hasTampermonkey = typeof GM_info !== 'undefined' || 
                                   window.chrome?.runtime?.getManifest;
            
            const badge = document.getElementById('statusBadge');
            
            if (navigator.userAgent.includes('Tampermonkey')) {
                badge.innerHTML = 'âœ… Tampermonkey Terdeteksi';
                badge.className = 'status-badge success';
                return true;
            } else {
                badge.innerHTML = 'âš ï¸ Tampermonkey Belum Terinstall';
                badge.className = 'status-badge warning';
                showTampermonkeyAlert();
                return false;
            }
        }

        function showTampermonkeyAlert() {
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert-box';
            alertDiv.innerHTML = `
                <h3>âš ï¸ Tampermonkey Diperlukan</h3>
                <p>Install Tampermonkey terlebih dahulu:</p>
                <ul>
                    <li>Chrome/Edge: <a href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo" target="_blank">Install Extension</a></li>
                    <li>Firefox: <a href="https://addons.mozilla.org/en-US/firefox/addon/tampermonkey/" target="_blank">Install Add-on</a></li>
                </ul>
            `;
            
            const card = document.querySelector('.card');
            card.insertBefore(alertDiv, card.firstChild);
        }

        // Track install (optional)
        function trackInstall(version) {
            console.log(`[PKM] User clicked install ${version} version`);
            // Bisa tambah analytics di sini
        }

        // Load version dari manifest
        function loadVersion() {
            fetch('manifest.json')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('version').textContent = data.version || '1.0.0';
                })
                .catch(error => {
                    console.error('Error loading version:', error);
                    document.getElementById('version').textContent = '1.0.0';
                });
        }

        // Initialize
        window.onload = function() {
            checkTampermonkey();
            loadVersion();
        };
    </script>
</body>
</html>