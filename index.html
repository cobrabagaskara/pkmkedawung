<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ PKM Kedawung - Modular Script Installer v3.0.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ====== VARIABLES & RESET ====== */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --dark-color: #2c3e50;
            --light-color: #f8f9fa;
            --border-radius: 16px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
        }

        /* ====== HEADER ====== */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--primary-gradient);
        }

        .header h1 {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.8rem;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .subtitle {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .loader-version {
            display: inline-block;
            background: var(--primary-gradient);
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1rem;
            margin-top: 10px;
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
        }

        /* ====== MAIN CARD ====== */
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
        }

        /* ====== STATUS BADGE ====== */
        .status-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            margin-bottom: 25px;
            font-size: 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .status-success {
            background: linear-gradient(135deg, var(--success-color), #27ae60);
            color: white;
        }

        .status-warning {
            background: linear-gradient(135deg, var(--warning-color), #e67e22);
            color: white;
        }

        .status-danger {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
            color: white;
        }

        /* ====== FEATURES SECTION ====== */
        .features-section {
            background: var(--light-color);
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            border-left: 5px solid #667eea;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .feature-title {
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--dark-color);
            font-size: 1.2rem;
        }

        /* ====== BUTTONS ====== */
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
        }

        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            text-decoration: none;
            text-align: center;
            transition: var(--transition);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            border: none;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }

        .btn:hover::after {
            transform: translateX(0);
        }

        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary-gradient);
            color: white;
        }

        .btn i {
            margin-right: 15px;
            font-size: 1.5rem;
        }

        /* ====== MODULES INFO ====== */
        .modules-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
        }

        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .module-badge {
            background: white;
            padding: 12px 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }

        .module-badge:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .module-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-gradient);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }

        .module-name {
            font-weight: 600;
            color: var(--dark-color);
        }

        /* ====== QR CODE ====== */
        .qr-section {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            margin: 30px 0;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            padding: 10px;
            background: white;
        }

        /* ====== MANUAL INSTALL ====== */
        .manual-install {
            background: #f1f8ff;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            border-left: 5px solid #0366d6;
        }

        .manual-install ol {
            padding-left: 25px;
            margin-top: 15px;
        }

        .manual-install li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        /* ====== FOOTER ====== */
        .footer-note {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.95rem;
            border-top: 1px solid #eee;
            margin-top: 30px;
        }

        .version-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .version-badge {
            background: var(--dark-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* ====== ALERT BOX ====== */
        .alert-box {
            background: linear-gradient(135deg, #fff9db 0%, #ffec99 100%);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid var(--warning-color);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(243, 156, 18, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(243, 156, 18, 0); }
            100% { box-shadow: 0 0 0 0 rgba(243, 156, 18, 0); }
        }

        /* ====== RESPONSIVE ====== */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.2rem;
            }
            
            .features-grid, .modules-grid {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 18px;
                font-size: 1.1rem;
            }
            
            .btn-group {
                gap: 15px;
            }
            
            .card {
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .btn i {
                margin-right: 10px;
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1><i class="fas fa-cube"></i> PKM Kedawung</h1>
            <p class="subtitle">Sistem Modular Loader v<span id="loaderVersion">3.0.0</span></p>
            <p>"Satu Instalasi, Banyak Modul, Auto-Update Terpusat"</p>
            <div class="loader-version" id="loaderVersionBadge">Loader v3.0.0</div>
        </div>

        <!-- MAIN CARD -->
        <div class="card">
            <!-- Status Badge (Auto-detect Tampermonkey) -->
            <div class="status-badge" id="statusBadge">
                <i class="fas fa-sync fa-spin"></i> Mendeteksi Tampermonkey...
            </div>

            <!-- Alert Box (Muncul jika Tampermonkey tidak terdeteksi) -->
            <div id="tampermonkeyAlert" style="display: none;"></div>

            <!-- Features Section -->
            <div class="features-section">
                <h2><i class="fas fa-star"></i> Keunggulan Sistem Baru</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fas fa-puzzle-piece"></i></div>
                        <div class="feature-title">Sistem Modular</div>
                        <p>Cukup install <strong>satu loader</strong>, semua module di folder <code>/modules</code> otomatis tersedia.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fas fa-sync-alt"></i></div>
                        <div class="feature-title">Auto-Update</div>
                        <p>Notifikasi otomatis saat ada versi baru. Update semua module sekaligus.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fas fa-sliders-h"></i></div>
                        <div class="feature-title">Dashboard Kontrol</div>
                        <p>Toggle module on/off via dashboard interaktif di pojok kanan bawah.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fas fa-code"></i></div>
                        <div class="feature-title">Developer Friendly</div>
                        <p>Tambah module baru cukup buat file .js di folder modules. Tidak perlu header manual.</p>
                    </div>
                </div>
            </div>

            <!-- Available Modules -->
            <div class="modules-section">
                <h2><i class="fas fa-box-open"></i> Module Tersedia</h2>
                <p>Module yang sudah terkonfigurasi di sistem:</p>
                <div class="modules-grid" id="modulesList">
                    <!-- Daftar module akan diisi oleh JavaScript -->
                </div>
            </div>

            <!-- Install Buttons -->
            <div class="btn-group">
                <a href="https://raw.githubusercontent.com/cobrabagaskara/pkmkedawung/main/loader.user.js" 
                   class="btn btn-primary" 
                   id="installButton"
                   target="_blank">
                    <i class="fas fa-rocket"></i> INSTALL LOADER SEKARANG
                </a>
                
                <a href="https://github.com/cobrabagaskara/pkmkedawung" 
                   class="btn btn-secondary" 
                   target="_blank">
                    <i class="fab fa-github"></i> BUKA REPOSITORY GITHUB
                </a>
            </div>

            <!-- QR Code -->
            <div class="qr-section">
                <h3><i class="fas fa-qrcode"></i> Install via QR Code</h3>
                <p>Scan untuk buka halaman installer di smartphone:</p>
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=https://raw.githubusercontent.com/cobrabagaskara/pkmkedawung/main/loader.user.js&format=svg&color=667eea&bgcolor=f8f9fa" 
                     alt="QR Code untuk Install PKM Kedawung Loader" 
                     class="qr-code">
                <p><small>Scan ‚Üí Buka link ‚Üí Klik Install di Tampermonkey</small></p>
            </div>

            <!-- Manual Install -->
            <div class="manual-install">
                <h3><i class="fas fa-wrench"></i> Panduan Install Manual</h3>
                <ol>
                    <li>Pastikan <strong>Tampermonkey</strong> sudah terinstall di browser Anda</li>
                    <li>Klik <a href="https://raw.githubusercontent.com/cobrabagaskara/pkmkedawung/main/loader.user.js" target="_blank">link loader.user.js</a> dan copy seluruh teksnya</li>
                    <li>Buka Tampermonkey ‚Üí Create a new script</li>
                    <li>Paste kode yang sudah dicopy ‚Üí Klik Save (Ctrl+S)</li>
                    <li>Selesai! Loader akan aktif dan mulai memuat module yang tersedia</li>
                </ol>
                <p><strong>Catatan:</strong> Setelah install, buka website apa saja dan lihat pojok kanan bawah untuk akses dashboard kontrol.</p>
            </div>

            <!-- Footer -->
            <div class="footer-note">
                <p><i class="fas fa-info-circle"></i> Setelah install, loader akan otomatis:</p>
                <p>1. Mengecek update setiap 15 menit<br>
                   2. Memuat module yang sesuai dengan website yang dibuka<br>
                   3. Menampilkan tombol dashboard di pojok kanan bawah</p>
                
                <div class="version-info">
                    <div class="version-badge">
                        <i class="fas fa-code-branch"></i> Loader: <span id="currentVersion">v3.0.0</span>
                    </div>
                    <div class="version-badge">
                        <i class="fas fa-cubes"></i> Modules: <span id="modulesCount">0</span> tersedia
                    </div>
                </div>
                
                <p style="margin-top: 20px; font-size: 0.9rem; color: #888;">
                    Dibuat untuk Tim PKM Kedawung ‚Ä¢ Sistem Modular v3.0.0<br>
                    <small>¬© 2026 - <a href="https://github.com/cobrabagaskara" target="_blank">cobrabagaskara</a></small>
                </p>
            </div>
        </div>
    </div>

    <script>
        // ==================== KONFIGURASI ====================
        const CONFIG = {
            REPO_RAW: 'https://raw.githubusercontent.com/cobrabagaskara/pkmkedawung/main',
            MANIFEST_URL: 'https://raw.githubusercontent.com/cobrabagaskara/pkmkedawung/main/manifest.json',
            MODULES_CONFIG_URL: 'https://raw.githubusercontent.com/cobrabagaskara/pkmkedawung/main/modules/modules.json',
            LOADER_VERSION: '3.0.0'
        };

        // ==================== FUNGSI UTAMA ====================
        
        // 1. Cek Tampermonkey
        function checkTampermonkey() {
            const badge = document.getElementById('statusBadge');
            const alertBox = document.getElementById('tampermonkeyAlert');
            
            // Cek berbagai cara deteksi Tampermonkey
            const hasTampermonkey = 
                typeof GM_info !== 'undefined' || 
                (window.chrome && chrome.runtime && chrome.runtime.getManifest) ||
                navigator.userAgent.includes('Tampermonkey');
            
            if (hasTampermonkey) {
                badge.innerHTML = '<i class="fas fa-check-circle"></i> ‚úÖ Tampermonkey Terdeteksi! Siap Install';
                badge.className = 'status-badge status-success';
                alertBox.style.display = 'none';
                return true;
            } else {
                badge.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ‚ö†Ô∏è Tampermonkey Belum Terinstall';
                badge.className = 'status-badge status-warning';
                
                // Tampilkan alert box
                alertBox.style.display = 'block';
                alertBox.innerHTML = `
                    <div class="alert-box">
                        <h3><i class="fas fa-download"></i> Tampermonkey Diperlukan</h3>
                        <p>Untuk menjalankan PKM Kedawung Loader, Anda perlu menginstall ekstensi Tampermonkey terlebih dahulu:</p>
                        <div style="display: flex; gap: 15px; margin-top: 15px; flex-wrap: wrap;">
                            <a href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo" 
                               class="btn btn-primary" 
                               style="padding: 12px 20px; font-size: 1rem; flex: 1; min-width: 200px;"
                               target="_blank">
                                <i class="fab fa-chrome"></i> Install untuk Chrome/Edge
                            </a>
                            <a href="https://addons.mozilla.org/en-US/firefox/addon/tampermonkey/" 
                               class="btn btn-secondary" 
                               style="padding: 12px 20px; font-size: 1rem; flex: 1; min-width: 200px;"
                               target="_blank">
                                <i class="fab fa-firefox"></i> Install untuk Firefox
                            </a>
                        </div>
                        <p style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                            Setelah install Tampermonkey, refresh halaman ini untuk melanjutkan.
                        </p>
                    </div>
                `;
                
                return false;
            }
        }
        
        // 2. Load versi dari manifest
        async function loadVersionInfo() {
            try {
                const response = await fetch(CONFIG.MANIFEST_URL);
                const data = await response.json();
                
                document.getElementById('currentVersion').textContent = `v${data.version}`;
                document.getElementById('loaderVersion').textContent = data.version;
                document.getElementById('loaderVersionBadge').textContent = `Loader v${data.version}`;
                
                console.log(`‚úÖ Loader version: v${data.version}`);
            } catch (error) {
                console.error('Error loading version:', error);
                document.getElementById('currentVersion').textContent = 'v3.0.0';
            }
        }
        
        // 3. Load daftar module
        async function loadModulesList() {
            try {
                const response = await fetch(CONFIG.MODULES_CONFIG_URL);
                const data = await response.json();
                
                const modulesContainer = document.getElementById('modulesList');
                const modulesCount = document.getElementById('modulesCount');
                
                if (data.modules && Object.keys(data.modules).length > 0) {
                    modulesContainer.innerHTML = '';
                    let count = 0;
                    
                    for (const [moduleId, moduleConfig] of Object.entries(data.modules)) {
                        count++;
                        const moduleCard = document.createElement('div');
                        moduleCard.className = 'module-badge';
                        moduleCard.innerHTML = `
                            <div class="module-icon">${moduleId.charAt(0).toUpperCase()}</div>
                            <div>
                                <div class="module-name">${moduleConfig.name}</div>
                                <small style="color: #666; font-size: 0.85rem;">v${moduleConfig.version}</small>
                            </div>
                        `;
                        modulesContainer.appendChild(moduleCard);
                    }
                    
                    modulesCount.textContent = count;
                    console.log(`‚úÖ Loaded ${count} modules`);
                } else {
                    modulesContainer.innerHTML = '<p style="color: #666; text-align: center; grid-column: 1 / -1;">Belum ada module yang terkonfigurasi</p>';
                    modulesCount.textContent = '0';
                }
            } catch (error) {
                console.error('Error loading modules:', error);
                document.getElementById('modulesCount').textContent = '0';
                document.getElementById('modulesList').innerHTML = 
                    '<p style="color: #e74c3c; text-align: center; grid-column: 1 / -1;">Gagal memuat daftar module</p>';
            }
        }
        
        // 4. Track install klik
        function setupInstallTracking() {
            const installButton = document.getElementById('installButton');
            
            installButton.addEventListener('click', function() {
                console.log('[PKM] User mengklik install loader');
                
                // Simpan timestamp instalasi
                localStorage.setItem('pkm_last_install_attempt', new Date().toISOString());
                
                // Tampilkan pesan sukses
                setTimeout(() => {
                    alert('‚úÖ Instalasi Berhasil!\n\n1. Klik "Install" di Tampermonkey\n2. Buka website apa saja untuk test\n3. Lihat pojok kanan bawah untuk dashboard\n\nSelamat menggunakan PKM Kedawung!');
                }, 500);
            });
        }
        
        // 5. Initialize
        async function initialize() {
            console.log('üöÄ PKM Kedawung Installer Initializing...');
            
            // Cek Tampermonkey
            checkTampermonkey();
            
            // Load informasi versi
            await loadVersionInfo();
            
            // Load daftar module
            await loadModulesList();
            
            // Setup event tracking
            setupInstallTracking();
            
            // Cek jika sudah pernah install
            const lastInstall = localStorage.getItem('pkm_last_install_attempt');
            if (lastInstall) {
                const lastDate = new Date(lastInstall);
                const now = new Date();
                const diffHours = (now - lastDate) / (1000 * 60 * 60);
                
                if (diffHours < 24) {
                    console.log(`[PKM] User pernah mencoba install ${Math.round(diffHours)} jam yang lalu`);
                }
            }
            
            console.log('‚úÖ PKM Kedawung Installer Ready!');
        }
        
        // Jalankan saat halaman siap
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }
        
        // Refresh detection jika user menginstall Tampermonkey
        window.addEventListener('focus', function() {
            setTimeout(checkTampermonkey, 1000);
        });
    </script>
</body>
</html>
