// Module: PKM Converter - Solid Edition
// File: modules/converter-tool-solid.js
// Description: Converter akurat untuk konversi script Tampermonkey ke module PKM

PKM.log('Converter Solid Edition loaded', 'info');

// ==================== CORE CONVERSION ENGINE ====================
const PKMConverter = {
    VERSION: '1.0.0',
    
    // ========== CONFIGURATION ==========
    CONFIG: {
        // GM_* to PKM.* mapping
        GM_MAPPINGS: {
            'GM_getValue': { 
                replacement: 'PKM.storage.get',
                comment: '// PKM: Storage getter' 
            },
            'GM_setValue': { 
                replacement: 'PKM.storage.set',
                comment: '// PKM: Storage setter' 
            },
            'GM_deleteValue': { 
                replacement: 'PKM.storage.set',
                comment: '// PKM: Set to null to delete' 
            },
            'GM_notification': { 
                replacement: 'pkmShowNotification',
                comment: '// PKM: Custom notification function',
                addHelper: true 
            },
            'GM_xmlhttpRequest': { 
                replacement: 'fetch',
                comment: '// PKM: Use fetch() API instead',
                addHelper: false 
            },
            'GM_addStyle': { 
                replacement: 'pkmAddStyle',
                comment: '// PKM: Dynamic style injection',
                addHelper: true 
            },
            'GM_registerMenuCommand': { 
                replacement: '// PKM: Use dashboard for controls',
                comment: '// PKM: Menu commands not available in module' 
            }
        },
        
        // Template untuk module output
        TEMPLATE: {
            header: `// Module: {name}
// Generated by PKM Converter v{converterVersion}
// Original: {originalName} v{originalVersion}
// Converted: {timestamp}

// ========== PKM OBJECT ==========
var PKM = {
    config: {config},
    id: '{moduleId}',
    version: '{version}',
    log: function(message, type) {
        const styles = {
            info: 'color: #3498db',
            success: 'color: #2ecc71',
            warn: 'color: #f39c12',
            error: 'color: #e74c3c'
        };
        console.log(\`%c[{name}] \${message}\`, styles[type] || styles.info);
    },
    storage: {
        get: function(key) {
            try {
                const fullKey = \`pkm_{moduleId}_\${key}\`;
                const value = localStorage.getItem(fullKey);
                return value ? JSON.parse(value) : null;
            } catch (e) { return null; }
        },
        set: function(key, value) {
            try {
                const fullKey = \`pkm_{moduleId}_\${key}\`;
                localStorage.setItem(fullKey, JSON.stringify(value));
                return true;
            } catch (e) { return false; }
        }
    },
    utils: {
        waitForElement: function(selector, timeout = 10000) {
            return new Promise((resolve, reject) => {
                const element = document.querySelector(selector);
                if (element) { resolve(element); return; }
                
                const observer = new MutationObserver(() => {
                    const element = document.querySelector(selector);
                    if (element) { observer.disconnect(); resolve(element); }
                });
                
                observer.observe(document.body, { childList: true, subtree: true });
                setTimeout(() => { observer.disconnect(); reject(new Error('Element not found')); }, timeout);
            });
        }
    }
};

// ========== HELPER FUNCTIONS ==========
{pkmHelpers}

// ========== MODULE CODE ==========`,
            
            footer: `
// ========== AUTO INITIALIZATION ==========
function initModule() {
    try {
        PKM.log('Module initializing', 'info');
        {initCalls}
        PKM.log('Module initialized successfully', 'success');
    } catch (error) {
        PKM.log('Initialization failed: ' + error.message, 'error');
    }
}

// Smart initialization with proper timing
function startModule() {
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initModule, 100); // Extra delay after DOM ready
        });
    } else {
        // If DOM already ready, wait a bit for dynamic content
        setTimeout(initModule, 300);
    }
}

// Expose functions to window for debugging
window.PKM = PKM;
window.initModule = initModule;
window.startModule = startModule;

// Start the module
setTimeout(startModule, 50);

PKM.log('Module loaded and ready', 'success');`
        }
    },
    
    // ========== STATE ==========
    state: {
        currentFile: null,
        conversionResult: null,
        errors: [],
        warnings: []
    },
    
    // ========== CORE CONVERSION FUNCTIONS ==========
    
    // 1. Parse Tampermonkey metadata
    parseMetadata(code) {
        const metadata = {
            originalName: 'Unnamed Script',
            originalVersion: '1.0.0',
            description: 'No description',
            author: 'Unknown',
            match: ['*://*/*'],
            namespace: '',
            grants: []
        };
        
        try {
            // Extract header block
            const headerMatch = code.match(/\/\/ ==UserScript==([\s\S]*?)\/\/ ==\/UserScript==/);
            if (!headerMatch) {
                this.addWarning('No Tampermonkey header found');
                return metadata;
            }
            
            const header = headerMatch[1];
            
            // Parse each metadata line
            const patterns = {
                name: /@name\s+(.+)/i,
                version: /@version\s+(.+)/i,
                description: /@description\s+(.+)/i,
                author: /@author\s+(.+)/i,
                namespace: /@namespace\s+(.+)/i,
                match: /@match\s+(.+)/gi,
                grant: /@grant\s+(.+)/gi
            };
            
            for (const [key, pattern] of Object.entries(patterns)) {
                const matches = header.match(pattern);
                if (matches) {
                    if (key === 'match' || key === 'grant') {
                        metadata[key] = matches.map(m => 
                            m.replace(new RegExp(`@${key}\\s+`, 'i'), '').trim()
                        );
                    } else {
                        metadata[key] = matches[1].trim();
                    }
                }
            }
            
            // If no match patterns found, use default
            if (!metadata.match || metadata.match.length === 0) {
                metadata.match = ['*://*/*'];
                this.addWarning('No @match found, using default pattern');
            }
            
        } catch (error) {
            this.addError('Failed to parse metadata: ' + error.message);
        }
        
        return metadata;
    },
    
    // 2. Remove Tampermonkey wrapper
    removeWrapper(code) {
        let cleaned = code;
        
        try {
            // Remove header block
            cleaned = cleaned.replace(/\/\/ ==UserScript==[\s\S]*?\/\/ ==\/UserScript==/g, '');
            
            // Remove common wrapper patterns
            const wrapperPatterns = [
                // Standard Tampermonkey wrapper
                /\(\s*function\s*\(\s*\)\s*\{[\s\S]*?['"]use strict['"][\s\S]*?\}\s*\)\s*\(\s*\)\s*;?/,
                // Any IIFE pattern
                /\(\s*function\s*\([^)]*\)\s*\{[\s\S]*?\}\s*\)\s*\([^)]*\)\s*;?/,
                // jQuery ready wrapper
                /\$\s*\(\s*document\s*\)\s*\.\s*ready\s*\(\s*function\s*\([^)]*\)\s*\{[\s\S]*?\}\s*\)\s*;?/,
                // DOMContentLoaded wrapper
                /document\s*\.\s*addEventListener\s*\(\s*['"]DOMContentLoaded['"][\s\S]*?function\s*\([^)]*\)\s*\{[\s\S]*?\}\s*\)\s*;?/
            ];
            
            wrapperPatterns.forEach(pattern => {
                cleaned = cleaned.replace(pattern, '');
            });
            
            // Trim extra whitespace
            cleaned = cleaned.trim();
            
            // Remove empty lines at start/end
            cleaned = cleaned.replace(/^\s*\n+|\n+\s*$/g, '');
            
        } catch (error) {
            this.addError('Wrapper removal failed: ' + error.message);
        }
        
        return cleaned;
    },
    
    // 3. Convert GM_* functions to PKM.*
    convertGMFunctions(code) {
        let converted = code;
        const addedHelpers = new Set();
        
        try {
            // Convert each GM_* function
            for (const [gmFunc, mapping] of Object.entries(this.CONFIG.GM_MAPPINGS)) {
                const regex = new RegExp(`\\b${gmFunc}\\b`, 'g');
                const matches = converted.match(regex);
                
                if (matches && matches.length > 0) {
                    // Add helper function if needed
                    if (mapping.addHelper && !addedHelpers.has(gmFunc)) {
                        addedHelpers.add(gmFunc);
                    }
                    
                    // Replace with mapping
                    converted = converted.replace(regex, mapping.replacement);
                    
                    this.addWarning(`Converted ${matches.length} ${gmFunc}() calls`);
                }
            }
            
            // Add helper functions if needed
            let helpersCode = '';
            if (addedHelpers.has('GM_notification')) {
                helpersCode += `
// Notification helper (replaces GM_notification)
function pkmShowNotification(title, text, options) {
    console.log(\`%cüì¢ \${title}: \${text}\`, 'background: #3498db; color: white; padding: 5px;');
    // Simple alert fallback
    if (typeof alert === 'function') {
        setTimeout(() => alert(\`\${title}\\n\\n\${text}\`), 100);
    }
}
`;
            }
            
            if (addedHelpers.has('GM_addStyle')) {
                helpersCode += `
// Style injection helper (replaces GM_addStyle)
function pkmAddStyle(css) {
    const style = document.createElement('style');
    style.textContent = css;
    document.head.appendChild(style);
    return style;
}
`;
            }
            
            return {
                code: converted,
                helpers: helpersCode
            };
            
        } catch (error) {
            this.addError('GM function conversion failed: ' + error.message);
            return { code: converted, helpers: '' };
        }
    },
    
    // 4. Extract initialization calls (main functions to call)
    extractInitCalls(code) {
        const initCalls = [];
        
        try {
            // Look for common initialization patterns
            const patterns = [
                // Function calls that might be main entry points
                /(\w+)\s*\(\s*\)\s*;/g,
                // Event listeners that should be called
                /addEventListener\s*\(\s*['"]load['"]/g,
                /addEventListener\s*\(\s*['"]DOMContentLoaded['"]/g,
                // jQuery ready calls
                /\$\(document\)\.ready\(/g
            ];
            
            // Also look for obvious main function names
            const mainFunctionNames = [
                'main', 'init', 'initialize', 'start', 'run',
                'setup', 'load', 'onLoad', 'onReady'
            ];
            
            // Check if any main functions exist
            mainFunctionNames.forEach(funcName => {
                const funcRegex = new RegExp(`function\\s+${funcName}\\s*\\(|const\\s+${funcName}\\s*=\\s*\\(|let\\s+${funcName}\\s*=\\s*\\(|var\\s+${funcName}\\s*=\\s*\\(`, 'i');
                if (funcRegex.test(code)) {
                    initCalls.push(`${funcName}();`);
                }
            });
            
            // Default init call if none found
            if (initCalls.length === 0) {
                initCalls.push('// Add initialization calls here');
                this.addWarning('No obvious initialization functions found');
            }
            
        } catch (error) {
            this.addError('Init extraction failed: ' + error.message);
            initCalls.push('// Error extracting initialization');
        }
        
        return initCalls.join('\n        ');
    },
    
    // 5. Generate final module code
    generateModule(metadata, cleanCode, helpers, initCalls) {
        try {
            // Generate module ID from name
            const moduleId = metadata.originalName
                .toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-|-$/g, '');
            
            // Prepare template variables
            const templateVars = {
                name: metadata.originalName,
                originalName: metadata.originalName,
                originalVersion: metadata.originalVersion,
                converterVersion: this.VERSION,
                timestamp: new Date().toISOString(),
                moduleId: moduleId,
                version: metadata.originalVersion,
                config: JSON.stringify({
                    name: metadata.originalName,
                    description: metadata.description,
                    version: metadata.originalVersion,
                    author: metadata.author,
                    match: metadata.match
                }, null, 2),
                pkmHelpers: helpers,
                initCalls: initCalls
            };
            
            // Apply template
            let moduleCode = this.CONFIG.TEMPLATE.header;
            for (const [key, value] of Object.entries(templateVars)) {
                moduleCode = moduleCode.replace(new RegExp(`{${key}}`, 'g'), value);
            }
            
            // Add the cleaned code
            moduleCode += '\n' + cleanCode;
            
            // Add footer
            let footer = this.CONFIG.TEMPLATE.footer;
            for (const [key, value] of Object.entries(templateVars)) {
                footer = footer.replace(new RegExp(`{${key}}`, 'g'), value);
            }
            
            moduleCode += footer;
            
            return {
                code: moduleCode,
                moduleId: moduleId,
                metadata: metadata
            };
            
        } catch (error) {
            this.addError('Module generation failed: ' + error.message);
            return null;
        }
    },
    
    // 6. Generate modules.json entry
    generateJsonEntry(metadata, moduleId) {
        const entry = {
            [moduleId]: {
                name: metadata.originalName,
                description: metadata.description,
                version: metadata.originalVersion,
                author: metadata.author,
                match: metadata.match
            }
        };
        
        return JSON.stringify(entry, null, 2);
    },
    
    // ========== MAIN CONVERSION FUNCTION ==========
    convert(code) {
        // Reset state
        this.state.errors = [];
        this.state.warnings = [];
        
        try {
            console.log('üîÑ Starting conversion...');
            
            // Step 1: Parse metadata
            const metadata = this.parseMetadata(code);
            console.log('‚úÖ Metadata parsed:', metadata.originalName);
            
            // Step 2: Remove wrapper
            const cleanedCode = this.removeWrapper(code);
            console.log('‚úÖ Wrapper removed');
            
            // Step 3: Convert GM functions
            const gmResult = this.convertGMFunctions(cleanedCode);
            console.log('‚úÖ GM functions converted');
            
            // Step 4: Extract initialization calls
            const initCalls = this.extractInitCalls(gmResult.code);
            console.log('‚úÖ Init calls extracted');
            
            // Step 5: Generate module
            const moduleResult = this.generateModule(
                metadata, 
                gmResult.code, 
                gmResult.helpers, 
                initCalls
            );
            
            if (!moduleResult) {
                throw new Error('Module generation failed');
            }
            
            // Step 6: Generate JSON entry
            const jsonEntry = this.generateJsonEntry(metadata, moduleResult.moduleId);
            
            // Prepare final result
            this.state.conversionResult = {
                moduleCode: moduleResult.code,
                jsonEntry: jsonEntry,
                metadata: metadata,
                moduleId: moduleResult.moduleId,
                errors: this.state.errors,
                warnings: this.state.warnings
            };
            
            console.log('‚úÖ Conversion completed successfully');
            console.log('üìä Stats:', {
                originalName: metadata.originalName,
                moduleId: moduleResult.moduleId,
                errors: this.state.errors.length,
                warnings: this.state.warnings.length
            });
            
            return this.state.conversionResult;
            
        } catch (error) {
            this.addError('Conversion process failed: ' + error.message);
            console.error('‚ùå Conversion failed:', error);
            return null;
        }
    },
    
    // ========== UTILITY FUNCTIONS ==========
    addError(message) {
        this.state.errors.push(message);
        console.error('‚ùå Converter Error:', message);
    },
    
    addWarning(message) {
        this.state.warnings.push(message);
        console.warn('‚ö†Ô∏è Converter Warning:', message);
    },
    
    reset() {
        this.state = {
            currentFile: null,
            conversionResult: null,
            errors: [],
            warnings: []
        };
    }
};

// ==================== SIMPLE UI ====================
function setupConverterUI() {
    // Remove existing UI if any
    const existingUI = document.getElementById('pkm-converter-simple');
    if (existingUI) existingUI.remove();
    
    // Create simple UI
    const ui = document.createElement('div');
    ui.id = 'pkm-converter-simple';
    ui.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        width: 350px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        z-index: 99999;
        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        overflow: hidden;
        border: 2px solid #667eea;
    `;
    
    ui.innerHTML = `
    <div style="
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    ">
        <div>
            <div style="font-weight: bold; font-size: 16px;">üîÑ PKM Converter</div>
            <div style="font-size: 12px; opacity: 0.9;">Solid Edition v${PKMConverter.VERSION}</div>
        </div>
        <button id="converterCloseBtn" style="
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
        ">√ó</button>
    </div>
    
    <div style="padding: 20px;">
        <!-- File Upload -->
        <div style="margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 10px; color: #333;">
                üìÅ Upload .user.js File
            </div>
            <input type="file" id="converterFileInput" accept=".js,.user.js" 
                   style="width: 100%; padding: 10px; border: 2px dashed #667eea; border-radius: 8px;">
            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                File export dari Tampermonkey
            </div>
        </div>
        
        <!-- Or Paste Code -->
        <div style="margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 10px; color: #333;">
                üìù Atau Paste Kode
            </div>
            <textarea id="converterCodeInput" placeholder="Paste kode Tampermonkey di sini..." 
                      style="width: 100%; height: 150px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; 
                             font-family: monospace; font-size: 12px; resize: vertical;"></textarea>
        </div>
        
        <!-- Convert Button -->
        <button id="converterProcessBtn" style="
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s;
        ">‚ö° Proses Konversi</button>
        
        <!-- Results (hidden initially) -->
        <div id="converterResults" style="display: none;">
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <div style="font-weight: 600; margin-bottom: 10px; color: #27ae60;">
                    ‚úÖ Konversi Berhasil!
                </div>
                <div style="font-size: 14px; color: #666;">
                    Download file di bawah ini:
                </div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <button id="downloadModuleBtn" style="
                    width: 100%;
                    padding: 10px;
                    background: #3498db;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    margin-bottom: 8px;
                    font-size: 14px;
                ">
                    üì• Download module.js
                </button>
                
                <button id="copyJsonBtn" style="
                    width: 100%;
                    padding: 10px;
                    background: #9b59b6;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    margin-bottom: 8px;
                    font-size: 14px;
                ">
                    üìã Copy JSON Entry
                </button>
                
                <div style="font-size: 12px; color: #666; text-align: center; margin-top: 10px;">
                    Upload module.js ke folder modules/<br>
                    Paste JSON ke modules.json
                </div>
            </div>
            
            <button id="newConversionBtn" style="
                width: 100%;
                padding: 8px;
                background: transparent;
                border: 1px solid #ddd;
                color: #666;
                border-radius: 6px;
                cursor: pointer;
                font-size: 13px;
            ">
                üîÑ Konversi File Lain
            </button>
        </div>
        
        <!-- Errors/Warnings -->
        <div id="converterMessages" style="display: none; margin-top: 15px;">
            <!-- Will be filled dynamically -->
        </div>
        
        <!-- Status -->
        <div id="converterStatus" style="
            font-size: 12px;
            color: #666;
            text-align: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        ">
            Status: Siap
        </div>
    </div>
    `;
    
    document.body.appendChild(ui);
    setupConverterEvents();
}

function setupConverterEvents() {
    // Close button
    document.getElementById('converterCloseBtn').addEventListener('click', () => {
        document.getElementById('pkm-converter-simple').remove();
    });
    
    // File input
    document.getElementById('converterFileInput').addEventListener('change', handleFileUpload);
    
    // Process button
    document.getElementById('converterProcessBtn').addEventListener('click', processConversion);
    
    // Download buttons (will be setup after conversion)
}

function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        document.getElementById('converterCodeInput').value = e.target.result;
        updateStatus(`File loaded: ${file.name}`);
    };
    reader.readAsText(file);
}

function processConversion() {
    const code = document.getElementById('converterCodeInput').value.trim();
    if (!code) {
        updateStatus('‚ùå Masukkan kode terlebih dahulu', 'error');
        return;
    }
    
    updateStatus('üîÑ Memproses konversi...', 'processing');
    
    // Perform conversion
    const result = PKMConverter.convert(code);
    
    if (!result) {
        updateStatus('‚ùå Konversi gagal', 'error');
        showMessages(PKMConverter.state.errors, PKMConverter.state.warnings);
        return;
    }
    
    // Show results
    document.getElementById('converterResults').style.display = 'block';
    
    // Setup download buttons
    document.getElementById('downloadModuleBtn').onclick = function() {
        downloadFile(result.moduleCode, result.moduleId + '.js', 'text/javascript');
    };
    
    document.getElementById('copyJsonBtn').onclick = function() {
        navigator.clipboard.writeText(result.jsonEntry).then(() => {
            alert('‚úÖ JSON entry berhasil disalin ke clipboard!');
        });
    };
    
    document.getElementById('newConversionBtn').onclick = function() {
        PKMConverter.reset();
        document.getElementById('converterCodeInput').value = '';
        document.getElementById('converterFileInput').value = '';
        document.getElementById('converterResults').style.display = 'none';
        document.getElementById('converterMessages').style.display = 'none';
        updateStatus('Siap untuk konversi baru');
    };
    
    // Show messages if any
    showMessages(result.errors, result.warnings);
    
    updateStatus(`‚úÖ ${result.metadata.originalName} berhasil dikonversi!`, 'success');
}

function updateStatus(message, type = 'info') {
    const statusEl = document.getElementById('converterStatus');
    const colors = {
        info: '#666',
        processing: '#f39c12',
        success: '#27ae60',
        error: '#e74c3c'
    };
    
    statusEl.textContent = `Status: ${message}`;
    statusEl.style.color = colors[type] || colors.info;
}

function showMessages(errors, warnings) {
    const messagesEl = document.getElementById('converterMessages');
    
    if (errors.length === 0 && warnings.length === 0) {
        messagesEl.style.display = 'none';
        return;
    }
    
    let html = '<div style="font-size: 13px;">';
    
    if (errors.length > 0) {
        html += '<div style="color: #e74c3c; margin-bottom: 10px;">';
        html += '<strong>‚ö†Ô∏è Errors:</strong><br>';
        errors.forEach(err => {
            html += `‚Ä¢ ${err}<br>`;
        });
        html += '</div>';
    }
    
    if (warnings.length > 0) {
        html += '<div style="color: #f39c12;">';
        html += '<strong>üìù Warnings:</strong><br>';
        warnings.forEach(warn => {
            html += `‚Ä¢ ${warn}<br>`;
        });
        html += '</div>';
    }
    
    html += '</div>';
    messagesEl.innerHTML = html;
    messagesEl.style.display = 'block';
}

function downloadFile(content, filename, type) {
    const blob = new Blob([content], { type: type });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    updateStatus(`‚úÖ ${filename} berhasil di-download`, 'success');
}

// ==================== INITIALIZATION ====================

// Add converter button to page
function addConverterButton() {
    const btn = document.createElement('button');
    btn.id = 'pkm-converter-btn-solid';
    btn.innerHTML = 'üîÑ';
    btn.title = 'PKM Converter - Solid Edition';
    
    btn.style.cssText = `
        position: fixed;
        bottom: 200px;
        right: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #f093fb, #f5576c);
        color: white;
        border: none;
        font-size: 22px;
        cursor: pointer;
        z-index: 99998;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
    `;
    
    btn.addEventListener('mouseenter', () => {
        btn.style.transform = 'scale(1.1) rotate(15deg)';
        btn.style.boxShadow = '0 6px 20px rgba(245, 87, 108, 0.4)';
    });
    
    btn.addEventListener('mouseleave', () => {
        btn.style.transform = 'scale(1) rotate(0)';
        btn.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)';
    });
    
    btn.addEventListener('click', setupConverterUI);
    
    document.body.appendChild(btn);
}

// Initialize converter
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(addConverterButton, 1000);
    });
} else {
    setTimeout(addConverterButton, 1000);
}

PKM.log('Converter Solid Edition initialized successfully', 'success');
